<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f0f2f5; }
        .stat-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            height: 100%; /* ‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏π‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô */
        }
        .stat-card:hover { transform: translateY(-5px); }
        .icon-box { font-size: 2.5rem; margin-bottom: 10px; }
        
        /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Reservation */
        .bg-purple { background-color: #6f42c1; color: white; }
    </style>
</head>
<body>

    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold text-dark">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î (Dashboard)</h2>
            <a href="/admin" class="btn btn-outline-secondary">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Admin</a>
        </div>

        <!-- ============================================ -->
        <!-- 1. ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô 5 ‡∏Å‡∏≤‡∏£‡πå‡∏î) -->
        <!-- ============================================ -->
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-5 g-3 mb-5">
            <!-- 1. ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
            <div class="col">
                <div class="card stat-card bg-primary text-white p-3 text-center">
                    <div class="icon-box">üë•</div>
                    <h6 class="opacity-75">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h6>
                    <h3 class="fw-bold">{{ stats.total_pax | default(0) }} ‡∏Ñ‡∏ô</h3>
                </div>
            </div>
            
            <!-- 2. Walk-in -->
            <div class="col">
                <div class="card stat-card bg-success text-white p-3 text-center">
                    <div class="icon-box">üö∂</div>
                    <h6 class="opacity-75">Walk-in</h6>
                    <h3 class="fw-bold">{{ stats.total_queues | default(0) }} ‡∏Ñ‡∏¥‡∏ß</h3>
                </div>
            </div>

            <!-- 3. Reservation (‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) -->
            <div class="col">
                <div class="card stat-card bg-purple p-3 text-center">
                    <div class="icon-box">üìÖ</div>
                    <h6 class="opacity-75">‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</h6>
                    <h3 class="fw-bold">{{ stats.total_reservations | default(0) }} ‡πÇ‡∏ï‡πä‡∏∞</h3>
                </div>
            </div>

            <!-- 4. Type A -->
            <div class="col">
                <div class="card stat-card bg-info text-white p-3 text-center">
                    <div class="icon-box">üÖ∞Ô∏è</div>
                    <h6 class="opacity-75">‡πÇ‡∏ï‡πä‡∏∞‡πÄ‡∏•‡πá‡∏Å (Type A)</h6>
                    <h3 class="fw-bold">{{ stats.type_a | default(0) }} ‡∏Ñ‡∏¥‡∏ß</h3>
                </div>
            </div>

            <!-- 5. Type B -->
            <div class="col">
                <div class="card stat-card bg-warning text-dark p-3 text-center">
                    <div class="icon-box">üÖ±Ô∏è</div>
                    <h6 class="opacity-75">‡πÇ‡∏ï‡πä‡∏∞‡πÉ‡∏´‡∏ç‡πà (Type B)</h6>
                    <h3 class="fw-bold">{{ stats.type_b | default(0) }} ‡∏Ñ‡∏¥‡∏ß</h3>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- 2. ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• -->
        <!-- ============================================ -->
        <div class="row g-3">
            <!-- ‡∏Å‡∏£‡∏≤‡∏ü 1: ‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡πÉ‡∏´‡∏ç‡πà‡∏´‡∏ô‡πà‡∏≠‡∏¢) -->
            <div class="col-md-12 col-lg-6">
                <div class="card shadow-sm p-4 h-100">
                    <h5 class="fw-bold text-secondary mb-3">üìà ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏Ñ‡∏ô)</h5>
                    <!-- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î max-height ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏∑‡∏î‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ -->
                    <canvas id="dailyChart" style="max-height: 300px;"></canvas>
                </div>
            </div>

            <!-- ‡∏Å‡∏£‡∏≤‡∏ü 2: Walk-in vs Reservation (‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) -->
            <div class="col-md-6 col-lg-3">
                <div class="card shadow-sm p-4 h-100">
                    <h5 class="fw-bold text-secondary mb-3">‚öñÔ∏è ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h5>
                    <canvas id="sourceChart"></canvas>
                    <div class="text-center mt-3 small text-muted">
                        Walk-in ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö ‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
                    </div>
                </div>
            </div>

            <!-- ‡∏Å‡∏£‡∏≤‡∏ü 3: ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÇ‡∏ï‡πä‡∏∞ (‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°) -->
            <div class="col-md-6 col-lg-3">
                <div class="card shadow-sm p-4 h-100">
                    <h5 class="fw-bold text-secondary mb-3">üçï ‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏ï‡πä‡∏∞ (Walk-in)</h5>
                    <canvas id="typeChart"></canvas>
                    <div class="text-center mt-3 small text-muted">
                        ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô A ‡πÅ‡∏•‡∏∞ B
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 1. ‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Python -->
    <script id="dashboard-data" type="application/json">
        {{ stats | tojson | safe }}
    </script>

    <!-- 2. ‡∏™‡πà‡∏ß‡∏ô JavaScript ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á -->
    <script>
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const rawData = document.getElementById('dashboard-data').textContent;
        const statsData = JSON.parse(rawData || '{}'); 

        const dailyData = statsData.daily_stats || {};
        const typeA = statsData.type_a || 0;
        const typeB = statsData.type_b || 0;
        
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
        const walkinCount = statsData.total_queues || 0;
        const reserveCount = statsData.total_reservations || 0;

        // --- ‡∏Å‡∏£‡∏≤‡∏ü 1: ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (Bar Chart) ---
        new Chart(document.getElementById('dailyChart'), {
            type: 'bar', 
            data: {
                labels: Object.keys(dailyData), 
                datasets: [{
                    label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏Ñ‡∏ô)',
                    data: Object.values(dailyData),
                    backgroundColor: 'rgba(54, 162, 235, 0.7)',
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // ‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏° Div
                scales: { y: { beginAtZero: true } }
            }
        });

        // --- ‡∏Å‡∏£‡∏≤‡∏ü 2: Walk-in vs Reservation (‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) ---
        new Chart(document.getElementById('sourceChart'), {
            type: 'doughnut',
            data: {
                labels: ['Walk-in (‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô)', 'Reservation (‡∏à‡∏≠‡∏á)'],
                datasets: [{
                    data: [walkinCount, reserveCount],
                    backgroundColor: ['#198754', '#6f42c1'], // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß vs ‡∏°‡πà‡∏ß‡∏á
                    hoverOffset: 4
                }]
            }
        });

        // --- ‡∏Å‡∏£‡∏≤‡∏ü 3: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÇ‡∏ï‡πä‡∏∞ (Doughnut Chart) ---
        new Chart(document.getElementById('typeChart'), {
            type: 'doughnut',
            data: {
                labels: ['Type A (1-4 ‡∏ó‡πà‡∏≤‡∏ô)', 'Type B (5+ ‡∏ó‡πà‡∏≤‡∏ô)'],
                datasets: [{
                    data: [typeA, typeB],
                    backgroundColor: ['#0dcaf0', '#ffc107'],
                    hoverOffset: 4
                }]
            }
        });
    </script>
</body>
</html>