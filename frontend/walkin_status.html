<!-- templates/walkin_status.html -->
<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏¥‡∏ß - Buffet Queue</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .queue-card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      .queue-header {
        background: linear-gradient(135deg, #0d6efd, #0dcaf0);
        color: white;
        padding: 30px 20px;
        text-align: center;
      }
      .dining-header {
        background: linear-gradient(135deg, #198754, #20c997);
        color: white;
        padding: 30px 20px;
        text-align: center;
      }
      .queue-number {
        font-size: 4rem;
        font-weight: 800;
        letter-spacing: 2px;
      }
      .time-box {
        background-color: #fff3cd;
        border: 2px solid #ffecb5;
        color: #856404;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
          <div class="card queue-card">
            <!-- ‚úÖ CASE 1: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏¥‡∏ô (Dining) -->
            {% if is_dining %}
            <div class="dining-header">
              <h2 class="fw-bold mb-0">üçΩÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h2>
              <p class="opacity-75 mb-0">‡∏ó‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!</p>
            </div>
            <div class="card-body p-4 text-center">
              <div class="py-3">
                <h1 class="display-1">üòã</h1>
                <h4 class="mt-3 text-dark fw-bold">‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢</h4>
              </div>
              <div class="time-box">
                <small class="d-block text-uppercase fw-bold opacity-75"
                  >‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏£‡∏≠‡∏ö</small
                >
                <h1 class="display-4 fw-bold text-danger mb-0">
                  {{ finish_time }}
                </h1>
              </div>
              <p class="text-muted mt-3 small">*‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡∏¥‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>
              <a
                href="/walkin"
                class="btn btn-outline-secondary w-100 rounded-pill mt-2"
                >‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a
              >
            </div>

            <!-- ‚úÖ CASE 2: ‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß (Waiting) -->
            {% else %}
            <div class="queue-header">
              <h5 class="mb-0 text-uppercase opacity-75">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h5>
              <div class="queue-number">
                {{ queue.queue_type }}-{{ '%03d' % queue.id }}
              </div>
              <p class="mb-0 fs-5">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô {{ queue.pax }} ‡∏ó‡πà‡∏≤‡∏ô</p>
            </div>
            <div class="card-body p-4 text-center">
              <div class="row mb-3">
                <div class="col-6 border-end">
                  <small class="text-muted">‡∏£‡∏≠‡∏≠‡∏µ‡∏Å (‡∏Ñ‡∏¥‡∏ß)</small>
                  <h2 class="fw-bold text-primary">
                    {{ queue.position_wait if queue.position_wait else '0' }}
                  </h2>
                </div>

                <!-- üî¥ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç or queue.position_wait > 0 -->
                <div class="col-6">
                  <small class="text-muted">‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</small>

                  <!-- ‚úÖ ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö ‡πÉ‡∏™‡πà or queue.position_wait > 0 ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ -->
                  {% if time_diff > 0 %}
                  <h2 class="fw-bold text-danger">
                    {{ min_time_diff }} - {{ time_diff }}
                  </h2>
                  <small class="text-danger">‡∏ô‡∏≤‡∏ó‡∏µ</small>

                  {% else %}
                  <!-- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ 0 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏°‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ô‡∏µ‡πâ‡πÅ‡∏ó‡∏ô -->
                  <h2 class="fw-bold text-success">‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</h2>
                  <small class="text-success">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏¢!</small>
                  {% endif %}
                </div>
                <!-- ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
              </div>

              <div class="alert alert-light border">
                ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô: <strong>{{ estimated_time }}</strong>
              </div>

              <div class="d-grid gap-2 mt-4">
                <button
                  class="btn btn-primary rounded-pill py-2"
                  onclick="window.location.reload()"
                >
                  üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                </button>
                <form
                  action="/cancel-queue/{{ queue.id }}?source=walkin"
                  method="POST"
                  onsubmit="return confirm('‚ö†Ô∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');"
                >
                  <button
                    type="submit"
                    class="btn btn-link text-danger text-decoration-none btn-sm"
                  >
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏ß
                  </button>
                </form>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <script>
      localStorage.setItem("my_suki_queue_id", "{{ queue.id }}");
      const status = "{{ queue.status }}";
      if (status === "completed" || status === "cancelled") {
        localStorage.removeItem("my_suki_queue_id");
      }
    </script>
  </body>
</html>
