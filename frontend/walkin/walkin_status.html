<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏¥‡∏ß - Buffet Queue</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #f8f9fa; font-family: 'Kanit', sans-serif; }
    .queue-card {
      border: none; border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); overflow: hidden;
    }
    .queue-header {
      background: linear-gradient(135deg, #0d6efd, #0dcaf0);
      color: white; padding: 30px 20px; text-align: center;
    }
    .dining-header {
      background: linear-gradient(135deg, #198754, #20c997);
      color: white; padding: 30px 20px; text-align: center;
    }
    .queue-number { font-size: 4rem; font-weight: 800; letter-spacing: 2px; }
    .time-box {
      background-color: #fff3cd; border: 2px solid #ffecb5;
      color: #856404; padding: 15px; border-radius: 10px; margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-5">
        <div class="card queue-card">
          
          <!-- ‚úÖ CASE 1: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏¥‡∏ô (Dining) -->
          {% if is_dining %}
          <div class="dining-header">
            <h2 class="fw-bold mb-0">üçΩÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h2>
            <p class="opacity-75 mb-0">‡∏ó‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!</p>
          </div>
          <div class="card-body p-4 text-center">
            <div class="py-3">
              <h1 class="display-1">üòã</h1>
              <h4 class="mt-3 text-dark fw-bold">‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢</h4>
            </div>
            <div class="time-box">
              <small class="d-block text-uppercase fw-bold opacity-75">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏£‡∏≠‡∏ö</small>
              <h1 class="display-4 fw-bold text-danger mb-0">
                {{ finish_time }}
              </h1>
            </div>
            <p class="text-muted mt-3 small">*‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡∏¥‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>
            <a href="/walkin?branch_id={{ queue.branch_id }}"
              class="btn btn-outline-secondary w-100 rounded-pill mt-2">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
          </div>

          <!-- ‚úÖ CASE 2: ‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß (Waiting) -->
          {% else %}
          <div class="queue-header">
            <h5 class="mb-0 text-uppercase opacity-75">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h5>
            <div class="queue-number">
              {{ queue.queue_type }}-{{ '%03d' % queue.queue_no }}
            </div>
            <p class="mb-0 fs-5">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô {{ queue.pax }} ‡∏ó‡πà‡∏≤‡∏ô</p>
          </div>
          <div class="card-body p-4 text-center">
            
            <div class="row mb-4">
              <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏£‡∏≠ -->
              <div class="col-6 border-end">
                <small class="text-muted d-block">‡∏£‡∏≠‡∏≠‡∏µ‡∏Å (‡∏Ñ‡∏¥‡∏ß)</small>
                <h2 class="display-4 fw-bold text-primary mb-0">
                  {{ queue.position_wait if queue.position_wait else '0' }}
                </h2>
              </div>

              <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏≠ (‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡∏°‡πà) -->
              <div class="col-6">
                <small class="text-muted d-block">‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</small>

                {% if no_tables %}
                    <!-- ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏ï‡πä‡∏∞ Type ‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢ -->
                    <h4 class="fw-bold text-danger mt-2">‡πÄ‡∏ï‡πá‡∏°/‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏ï‡πä‡∏∞</h4>
                
                {% elif time_diff > 0 %}
                    <!-- ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ (‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤) -->
                    <h2 class="display-4 fw-bold text-danger mb-0">
                      {{ time_diff }}
                    </h2>
                    <small class="text-danger">‡∏ô‡∏≤‡∏ó‡∏µ</small>

                {% else %}
                    <!-- ‡∏Å‡∏£‡∏ì‡∏µ‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏•‡πâ‡∏ß (0 ‡∏ô‡∏≤‡∏ó‡∏µ) -->
                    <h3 class="fw-bold text-success mt-2">‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</h3>
                    <small class="text-success">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏¢!</small>
                {% endif %}
              </div>
            </div>

            <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
            <div class="alert alert-light border shadow-sm">
                {% if no_tables %}
                    <span class="text-danger">‚ùå ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏ï‡πä‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô {{ queue.pax }} ‡∏ó‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö</span>
                {% elif time_diff > 0 %} 
                    ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏ï‡πä‡∏∞‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: <br>
                    <strong>{{ estimated_time }}</strong> 
                {% else %} 
                    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <br>
                    <strong class="text-success fs-5">‚ú® ‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß/‡πÇ‡∏ï‡πä‡∏∞‡∏ß‡πà‡∏≤‡∏á</strong>
                {% endif %}
            </div>

            <div class="d-grid gap-2 mt-4">
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä -->
                <button class="btn btn-primary rounded-pill py-2" onclick="window.location.reload()">
                  üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                </button>
                
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å -->
                <form action="/cancel-queue/{{ queue.id }}?source=walkin&branch_id={{ queue.branch_id }}" method="POST"
                  onsubmit="return confirm('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏ß‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');">
                  <button type="submit" class="btn btn-link text-danger text-decoration-none btn-sm">
                    ‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏ß
                  </button>
                </form>
            </div>

          </div> <!-- ‡∏õ‡∏¥‡∏î card-body ‡∏Ç‡∏≠‡∏á waiting -->
          {% endif %} <!-- ‡∏õ‡∏¥‡∏î if is_dining -->

        </div>
      </div>
    </div>

    <!-- Script ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ LocalStorage (‡∏à‡∏≥‡∏Ñ‡∏¥‡∏ß) -->
    <script>
        // ‡∏à‡∏≥‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏Ç‡∏≤
        localStorage.setItem("my_suki_queue_id", "{{ queue.id }}");
        localStorage.setItem("my_suki_branch_id", "{{ queue.branch_id }}"); 

        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
        const status = "{{ queue.status }}";
        if (status === "completed" || status === "cancelled") {
            localStorage.removeItem("my_suki_queue_id");
            localStorage.removeItem("my_suki_branch_id");
        }
    </script>
</body>
</html>